<app-navbar></app-navbar>
<app-sidebar></app-sidebar>

<nav class="fixed right-0 top-0 pt-12 w-56 h-full bg-gray-50 shadow-md">
    <div class="w-full flex flex-col gap-y-2 mx-auto px-2 py-8 overflow-y-auto">
        <span class="text-2xl">Questions</span>
        <div class="px-1 underline text-blue-600 hover:text-blue-800 hover:cursor-pointer visited:text-purple-600" *ngFor="let question of assignment?.questions; let i = index">
            <div class="flex gap-2 items-center" (click)="jumpQuestion(i)">
                <span>Question {{i+1}}</span>
                <svg class="fill-teal-900" *ngIf="newAnswers[i] && newAnswers[i].answer && newAnswers[i].answer[0] !== 999" xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 448 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/></svg>
            </div>
            
        </div>
    </div>
</nav>

<div class="w-full text-center my-6 pt-20 pr-56 pl-20">
    <span class="font-medium text-2xl">{{ assignment?.name }}</span>
</div>

<div class="flex justify-center items-center h-full">
    <div *ngIf="currentQuestion < assignment?.questions.length" class="w-[60%] h-[36rem] my-5 mr-56 ml-20 bg-white rounded-md shadow-md text-center grid grid-rows-12">
        <div class="row-span-1 row-start-1 flex justify-between p-5">
            <span class="text-xl">{{ currentQuestion+1 }} / {{ assignment?.questions.length }}</span>
            <span class="text-xl">Time Remaining: {{getCountdown()}}</span>
            
        </div>
        <div *ngIf="!displayAnswer && assignment?.questions[currentQuestion].questionType !== 'Fill The Blanks'" class="row-span-3 text-xl row-start-2 pt-12 px-6">
            <span *ngIf="assignment?.questions[currentQuestion].questionType !== 'Drag and Drop'">{{ assignment?.questions[currentQuestion].question }}</span>
            <span *ngIf="assignment?.questions[currentQuestion].questionType === 'Drag and Drop'">
                <div *ngFor="let part of dragAndDropQuestion" class="flex-nowrap inline-flex justify-center">
                <span>{{ part }}</span>
                </div>
            </span>
        </div>
        <div *ngIf="displayAnswer && assignment?.questions[currentQuestion].questionType !== 'Fill The Blanks'" class="row-span-3 row-start-2 text-3xl pt-16 px-6">
            <div *ngIf="compareArrays(newAnswers[currentQuestion].answer, assignment?.questions[currentQuestion].answer)">
                Correct!
            </div>
            <div *ngIf="!compareArrays(newAnswers[currentQuestion].answer, assignment?.questions[currentQuestion].answer)">
                Incorrect!
            </div>
        </div>
        <div *ngIf="displayAnswer && assignment?.questions[currentQuestion].questionType === 'Fill The Blanks'" class="row-span-3 row-start-2 text-3xl pt-16 px-6">
            <div *ngIf="result">
                Correct!
            </div>
            <div *ngIf="!result">
                Incorrect!
            </div>
        </div>
        <div class="row-span-6 w-full">
            <div *ngIf="(assignment?.questions[currentQuestion].questionType=='Multiple Choice' || assignment?.questions[currentQuestion].questionType=='Multiple Answers' || assignment?.questions[currentQuestion].questionType=='True/False') && !displayAnswer" class="grid grid-cols-2 h-full gap-2 p-4">
                <button [disabled]="newAnswers[currentQuestion].answer[0] !== 999" (click)="submitAnswer('Choice', i)" *ngFor="let choice of assignment?.questions[currentQuestion].choices; let i = index" class="hover:cursor-pointer text-lg font-semibold bg-teal-800 py-2 text-white rounded-sm flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    
                    {{choice}}
        
                </button>
            </div>
    
            <div *ngIf="(assignment?.questions[currentQuestion].questionType=='Ordering') && !displayAnswer" class="w-1/2 mx-auto h-full" cdkDropList (cdkDropListDropped)="dropOrdering($event)">
                <div *ngFor="let choice of orderedChoices; let i = index" cdkDrag class="cursor-pointer mb-2 mt-2 bg-teal-800 h-14 bg-gray-50 rounded flex gap-2 items-center justify-center overflow-y-auto">
                    <div class="w-3 opacity-40">
                        <svg class="fill-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg>
                    </div>
                    <div class="w-3/4 text-white text-lg font-semibold">
                        {{choice}}
                    </div>
                    <div class="text-white">
                        {{i+1}}
                    </div>
                </div>
                <button [disabled]="newAnswers[currentQuestion].answer[0] !== 999" (click)="submitAnswer('Ordering')" class="text-white bg-blue-700 hover:bg-blue-800 font-medium rounded text-sm w-full sm:w-auto px-6 py-3 text-center dark:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed">Save</button>
            </div>
    
            <div *ngIf="(assignment?.questions[currentQuestion].questionType=='Drag and Drop') && !displayAnswer" class="text-center w-full flex flex-col gap-4 justify-around items-center h-full">
                    
                <div 
                    cdkDropList
                    #chosenAnswerList="cdkDropList"
                    [cdkDropListData]="dragAndDropAnswer"
                    [cdkDropListConnectedTo]="[choicesList]"
                    (cdkDropListDropped)="drop($event)"
                    cdkDropListOrientation="horizontal"
                    class="flex gap-2 mx-auto">
    
                    <div *ngFor="let blank of questionParts.blanks; let i = index" cdkDrag [cdkDragData]="{ type: 'blank', index: i }" class="border rounded-sm shadow-sm py-3 px-10">
                        <!-- <input type="text" placeholder="Blank {{i+1}}"> -->
                        <span *ngIf="!dragAndDropAnswer[i]">
                            {{ 'Blank ' + (i+1) }}
                        </span>
                        <span *ngIf="dragAndDropAnswer[i]">
                            {{ dragAndDropAnswer[i] }}
                        </span>
                    </div>
                    
                </div>
                  
                <div
                    cdkDropList 
                    #choicesList="cdkDropList"
                    [cdkDropListData]="dragAndDropChoices" 
                    [cdkDropListConnectedTo]="[chosenAnswerList]"
                    (cdkDropListDropped)="drop($event)"
                    class="flex justify-around w-full">
    
                    <div class="border py-3 px-10 shadow-sm" *ngFor="let choice of dragAndDropChoices" cdkDrag [cdkDragDisabled]="dragAndDropAnswer.length === questionParts.blanks.length">
                        <span>
                            {{ choice }}
                        </span>
                    </div>
    
                </div>
    
                <button [disabled]="newAnswers[currentQuestion].answer[0] !== 999" (click)="submitAnswer('Drag and Drop')" class="mt-auto mb-5 text-white bg-blue-700 hover:bg-blue-800 font-medium rounded text-sm w-auto px-6 py-3 text-center disabled:opacity-50 disabled:cursor-not-allowed">Save</button>
    
            </div>
    
            <div *ngIf="(assignment?.questions[currentQuestion].questionType=='Fill The Blanks') && !displayAnswer" class="text-center w-full flex flex-col p-5 items-center h-full">
                
                <div class="flex gap-2 items-center flex-grow justify-content-center">
                    <div *ngFor="let parts of questionPartsFtb; let i = index">
                        <div *ngIf="parts.value !== null">{{parts.value}}</div>
                        <div *ngIf="parts.value === null">
                            <input class="border rounded-sm p-2 w-full" type="text" name="{{i}}" [(ngModel)]="ftbAnswer">
                        </div>
                    </div>
                </div>
                
    
                <button [disabled]="newAnswers[currentQuestion].answer[0] !== 999" (click)="submitAnswer('Fill The Blanks')" class="mt-auto mb-5 text-white bg-blue-700 hover:bg-blue-800 font-medium rounded text-sm w-auto px-6 py-3 text-center disabled:opacity-50 disabled:cursor-not-allowed">Save</button>
    
            </div>
    
            <div *ngIf="displayAnswer" class="flex flex-col gap-4">
    
                <span class="text-2xl">Here is the correct answer:</span>
    
                <div>
                    <div *ngFor="let answer of currentAnswers" class="text-xl">
                    {{ answer }}
                    </div>
                </div>
    
            </div>
    
        </div>
    
        <div class="row-span-2 flex justify-between px-5 items-center">
            <button [disabled]="currentQuestion <= 0" (click)="lastQuestion()" class="text-white bg-teal-800 hover:bg-teal-900 font-medium rounded text-sm w-auto px-6 py-4 text-center disabled:opacity-50 disabled:cursor-not-allowed">Last</button>
            <span></span>
            <button *ngIf="currentQuestion < assignment?.questions.length-1" (click)="nextQuestion()" class="text-white bg-teal-800 hover:bg-teal-900 font-medium rounded text-sm w-auto px-6 py-4 text-center">Next</button>
            <button *ngIf="currentQuestion >= assignment?.questions.length-1" [disabled]="newAnswers[currentQuestion].answer.length === 0 || newAnswers[currentQuestion].answer === null" (click)="nextQuestion()" class="text-white bg-blue-700 hover:bg-blue-800 font-medium rounded text-sm w-auto px-6 py-4 text-center">Submit</button>

        </div>
        
    </div>
    
</div>

<div class="flex justify-center">
    <div *ngIf="currentQuestion >= assignment?.questions.length && this.newAnswers.length === this.assignment?.questions.length" class="w-[60%] h-[32rem] mr-56 ml-20 bg-white rounded-md shadow-md flex flex-col items-center justify-center">
        <span>Asignment Complete!</span>
        <a *ngIf="submitted" [routerLink]="['/student-class', classId]">{{ submissionConfirmation }}</a>
        <a *ngIf="!submitted" (click)="endAssignment()" class="hover:cursor-pointer">{{ submissionConfirmation }}</a>
    </div>
    <div *ngIf="currentQuestion >= assignment?.questions.length && this.newAnswers.length != this.assignment?.questions.length" class="w-[60%] h-[32rem] mr-56 ml-20 bg-white rounded-md shadow-md flex flex-col items-center justify-center">
        <span>Time Over!</span>
        <a *ngIf="submitted" [routerLink]="['/student-class', classId]">{{ submissionConfirmation }}</a>
        <a *ngIf="!submitted" (click)="endAssignment()" class="hover:cursor-pointer">{{ submissionConfirmation }}</a>
    </div>
</div>

<div class="flex justify-center">
    <div *ngIf="submissionError" class="transition w-[60%] mr-56 ml-20 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
        <strong class="font-bold">Submission Error!</strong>
        <span class="block sm:inline"> Please submit answers to all questions</span>
        <span class="absolute top-0 bottom-0 right-0 px-4 py-3">
          <svg (click)="submissionError = !submissionError" class="fill-current h-6 w-6 text-red-500" role="button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>Close</title><path d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"/></svg>
        </span>
      </div>
</div>

